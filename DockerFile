FROM python:3.11
WORKDIR /bot

# æ›´æ–°ãƒ»æ—¥æœ¬èªžåŒ–
RUN apt-get update && apt-get -y install locales && apt-get -y upgrade && \
	localedef -f UTF-8 -i ja_JP ja_JP.UTF-8
ENV LANG ja_JP.UTF-8
ENV LANGUAGE ja_JP:ja
ENV LC_ALL ja_JP.UTF-8
ENV TZ Asia/Tokyo
ENV TERM xterm

# pip install
COPY requirements.txt /bot/
RUN pip install -r requirements.txt
COPY . /bot

# ãƒãƒ¼ãƒˆé–‹æ”¾ (uvicornã§æŒ‡å®šã—ãŸãƒãƒ¼ãƒˆ)
EXPOSE 8080

# èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
RUN echo '#!/bin/bash\n\
echo "ðŸš€ Starting Discord Bot..."\n\
python app/main.py &\n\
BOT_PID=$!\n\
\n\
echo "ðŸŒ Starting health check server..."\n\
python app/access.py &\n\
SERVER_PID=$!\n\
\n\
echo "âœ… Both services started"\n\
echo "Bot PID: $BOT_PID"\n\
echo "Server PID: $SERVER_PID"\n\
\n\
# ä¸¡æ–¹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç›£è¦–\n\
wait $BOT_PID $SERVER_PID\n\
' > /bot/start.sh && chmod +x /bot/start.sh

# å®Ÿè¡Œ
CMD ["/bot/start.sh"]